<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpongeBob Clicker Adventure</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --primary-cyan: #00FFFF;
            --secondary-cyan: #00CED1;
            --accent-teal: #20B2AA;
            --accent-aqua: #40E0D0;
            --success-green: #00FA9A;
            --danger-coral: #FF7F50;
            --dark-teal: #008B8B;
            --light-cyan: #E0FFFF;
            --glass-bg: rgba(0, 255, 255, 0.15);
            --glass-border: rgba(0, 255, 255, 0.3);
            --shadow: 0 8px 32px rgba(0, 206, 209, 0.37);
            --shine-gradient: linear-gradient(45deg, transparent, rgba(255,255,255,0.8), transparent);
        }

        body {
            font-family: 'Fredoka', cursive;
            background: linear-gradient(135deg, #008B8B 0%, #20B2AA 50%, #00CED1 100%);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            user-select: none;
        }

        /* Animated background bubbles */
        .bubble {
            position: fixed;
            border-radius: 50%;
            background: rgba(0, 255, 255, 0.15);
            animation: float 8s ease-in-out infinite;
            pointer-events: none;
            z-index: 1;
            box-shadow: inset 0 0 20px rgba(255,255,255,0.3);
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.8; }
            90% { opacity: 0.8; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        .game-container {
            display: flex;
            min-height: 100vh;
            position: relative;
            z-index: 2;
        }

        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .game-title {
            font-size: 1.5em;
            font-weight: 700;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .top-controls {
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 8px 12px;
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(0, 255, 255, 0.25);
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .control-btn.muted {
            background: var(--danger-coral);
        }

        /* Larry Lobster Ad */
        .larry-ad {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 120px;
            height: 400px;
            background: linear-gradient(135deg, var(--accent-teal), var(--primary-cyan));
            border-radius: 20px;
            border: 3px solid var(--accent-aqua);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.5);
            z-index: 999;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .larry-ad:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 15px 40px rgba(0, 255, 255, 0.7);
        }

        .larry-ad-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 15px;
            color: white;
            text-align: center;
        }

        .larry-ad img {
            width: 70px;
            height: 70px;
            object-fit: contain;
            margin-bottom: 10px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .larry-ad h3 {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 8px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .larry-ad p {
            font-size: 12px;
            line-height: 1.4;
            opacity: 0.9;
        }

        .left-panel {
            flex: 1;
            padding: 80px 20px 20px 160px;
            background: linear-gradient(135deg, rgba(25, 25, 112, 0.9), rgba(0, 0, 139, 0.8));
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(100, 149, 237, 0.3);
            overflow-y: auto;
            max-height: 100vh;
        }

        .main-area {
            flex: 2;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 80px 20px 20px;
            overflow: hidden;
        }

        .stats {
            text-align: center;
            margin-bottom: 30px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow);
            min-width: 280px;
        }

        .clams {
            font-size: 2.8em;
            font-weight: 700;
            color: var(--accent-aqua);
            text-shadow: 0 3px 6px rgba(0,0,0,0.3);
            margin-bottom: 5px;
        }

        .cps {
            font-size: 1.3em;
            color: var(--success-green);
            font-weight: 500;
        }

        .playtime {
            font-size: 1em;
            color: var(--light-cyan);
            margin-top: 8px;
            opacity: 0.8;
        }

        .character-container {
            position: relative;
            width: min(300px, 70vw);
            height: min(300px, 70vw);
            margin: 20px 0;
        }

        .character {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid var(--accent-aqua);
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            background: radial-gradient(circle, rgba(224,255,255,0.9), rgba(175,238,238,0.7));
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        /* Shining effect */
        .character::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: var(--shine-gradient);
            animation: shine 3s linear infinite;
            opacity: 0.6;
        }

        @keyframes shine {
            0% { transform: rotate(0deg) translateX(-200%); }
            50% { opacity: 1; }
            100% { transform: rotate(0deg) translateX(200%); }
        }

        .character:hover {
            transform: scale(1.05);
            border-color: var(--primary-cyan);
            box-shadow: 0 12px 40px rgba(0, 255, 255, 0.6);
        }

        .character:active {
            transform: scale(0.95);
        }

        .character img {
            max-width: 75%;
            max-height: 75%;
            object-fit: contain;
            z-index: 1;
            position: relative;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .floating-clam {
            position: absolute;
            font-size: 1.6em;
            font-weight: 700;
            color: var(--accent-aqua);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            pointer-events: none;
            z-index: 1000;
            animation: floatUp 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }

        @keyframes floatUp {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(-120px) scale(1.3) rotate(15deg);
            }
        }

        .upgrades, .characters, .rewards {
            background: rgba(25, 25, 112, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 149, 237, 0.4);
            box-shadow: 0 8px 32px rgba(25, 25, 112, 0.5);
        }

        .section-title {
            font-size: 1.6em;
            font-weight: 600;
            color: white;
            text-align: center;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .upgrade-item, .character-item, .reward-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(30, 30, 139, 0.4);
            border: 1px solid rgba(100, 149, 237, 0.3);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .upgrade-item:hover, .character-item:hover, .reward-item:hover {
            background: rgba(65, 105, 225, 0.4);
            transform: translateX(5px) scale(1.02);
            box-shadow: 0 8px 32px rgba(65, 105, 225, 0.4);
        }

        .upgrade-item.disabled, .character-item.disabled, .reward-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .upgrade-item.disabled:hover, .character-item.disabled:hover, .reward-item.disabled:hover {
            transform: none;
            background: rgba(30, 30, 139, 0.4);
        }

        .reward-item.claimed {
            background: rgba(0, 250, 154, 0.2);
            border-color: var(--success-green);
        }

        .reward-item.ready {
            background: rgba(255, 215, 0, 0.3);
            border-color: #FFD700;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.8); }
        }

        .item-info {
            flex: 1;
        }

        .item-name {
            font-weight: 600;
            color: white;
            margin-bottom: 3px;
            font-size: 1.1em;
        }

        .item-desc {
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
        }

        .item-cost, .item-time {
            font-weight: 600;
            color: var(--accent-aqua);
            text-align: right;
            min-width: 80px;
            font-size: 1.1em;
        }

        .owned {
            background: rgba(0, 250, 154, 0.2);
            border-color: var(--success-green);
        }

        .current {
            background: rgba(64, 224, 208, 0.3);
            border-color: var(--accent-aqua);
            box-shadow: 0 0 20px rgba(64, 224, 208, 0.4);
        }

        .current-character {
            text-align: center;
            background: rgba(25, 25, 112, 0.7);
            backdrop-filter: blur(20px);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(100, 149, 237, 0.4);
            box-shadow: 0 8px 32px rgba(25, 25, 112, 0.5);
        }

        .current-character-name {
            font-weight: 600;
            color: white;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            overflow: hidden;
            margin-top: 10px;
            border: 1px solid var(--glass-border);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-green), var(--primary-cyan));
            border-radius: 6px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .character-unlock-info {
            text-align: center;
            font-size: 0.9em;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 8px;
            font-weight: 500;
        }

        /* Unlock popup */
        .unlock-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid var(--accent-aqua);
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            z-index: 10000;
            text-align: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .unlock-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .unlock-popup h2 {
            color: var(--accent-aqua);
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .unlock-popup p {
            color: white;
            font-size: 1.2em;
            font-weight: 500;
        }

        /* Mobile responsive */
        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            .left-panel {
                order: 2;
                max-height: none;
                padding: 20px;
            }
            
            .main-area {
                order: 1;
                padding: 80px 10px 20px;
            }
            
            .character-container {
                width: min(250px, 60vw);
                height: min(250px, 60vw);
            }

            .stats {
                min-width: auto;
                width: 90%;
            }

            .clams {
                font-size: 2.2em;
            }

            .game-title {
                font-size: 1.2em;
            }

            .larry-ad {
                position: relative;
                left: auto;
                top: auto;
                transform: none;
                width: 100%;
                height: 120px;
                margin-bottom: 20px;
                flex-direction: row;
            }

            .larry-ad-content {
                flex-direction: row;
                padding: 10px;
            }

            .larry-ad img {
                width: 50px;
                height: 50px;
                margin-right: 10px;
                margin-bottom: 0;
            }
        }

        @media (max-width: 480px) {
            .character-container {
                width: min(200px, 55vw);
                height: min(200px, 55vw);
            }

            .clams {
                font-size: 1.8em;
            }

            .top-bar {
                padding: 8px 15px;
            }

            .control-btn {
                padding: 6px 10px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <!-- Background bubbles -->
    <div class="bubble" style="width: 40px; height: 40px; left: 10%; animation-delay: 0s;"></div>
    <div class="bubble" style="width: 20px; height: 20px; left: 20%; animation-delay: 2s;"></div>
    <div class="bubble" style="width: 60px; height: 60px; left: 35%; animation-delay: 4s;"></div>
    <div class="bubble" style="width: 30px; height: 30px; left: 50%; animation-delay: 1s;"></div>
    <div class="bubble" style="width: 25px; height: 25px; left: 65%; animation-delay: 3s;"></div>
    <div class="bubble" style="width: 45px; height: 45px; left: 80%; animation-delay: 5s;"></div>

    <!-- Larry Lobster Ad -->
    <div class="larry-ad" id="larry-ad">
        <div class="larry-ad-content">
            <img src="https://static.wikia.nocookie.net/spongebob/images/0/05/Larry_the_Lobster_stock_image_standing.png/revision/latest/scale-to-width-down/1000?cb=20250218034609" alt="Larry">
            <div>
                <h3>Larry Lobster</h3>
                <p>Unlock the strongest crustacean in Bikini Bottom!</p>
                <p><strong>5 CPS</strong></p>
            </div>
        </div>
    </div>

    <div class="top-bar">
        <div class="game-title">SpongeBob Clicker Adventure</div>
        <div class="top-controls">
            <div class="control-btn" id="sound-toggle">Sound</div>
            <div class="control-btn" id="save-btn">Save</div>
            <div class="control-btn" id="reset-btn">Reset</div>
        </div>
    </div>

    <div class="game-container">
        <div class="left-panel">
            <div class="current-character">
                <div class="current-character-name" id="current-character-name">Gary the Snail</div>
                <div id="character-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="character-unlock-info" id="unlock-info">
                        Collect clams to unlock Plankton!
                    </div>
                </div>
            </div>

            <div class="rewards">
                <div class="section-title">Playtime Rewards</div>
                <div id="rewards-list"></div>
            </div>

            <div class="upgrades">
                <div class="section-title">Upgrades</div>
                <div id="upgrades-list"></div>
            </div>

            <div class="characters">
                <div class="section-title">Characters</div>
                <div id="characters-list"></div>
            </div>
        </div>

        <div class="main-area">
            <div class="stats">
                <div class="clams" id="clam-count">0</div>
                <div class="cps" id="cps-display">1.0 Clams per second</div>
                <div class="playtime" id="playtime-display">Playtime: 0m</div>
            </div>

            <div class="character-container">
                <div class="character" id="main-character">
                    <img id="character-image" src="https://static.wikia.nocookie.net/spongebob/images/9/9e/Gary_looking_up_stock_art.png/revision/latest?cb=20181227162221" alt="Gary">
                </div>
            </div>
        </div>
    </div>

    <!-- Unlock popup -->
    <div class="unlock-popup" id="unlock-popup">
        <h2>Character Unlocked!</h2>
        <p id="unlock-text">Congratulations!</p>
    </div>

    <script>
        // Game state with better defaults
        let gameState = {
            clams: 0,
            cps: 1,
            currentCharacterIndex: 7, // Start at Gary (last index)
            clickPower: 1,
            upgrades: {
                spatula: 0,
                grill: 0,
                fryer: 0,
                register: 0,
                restaurant: 0
            },
            characters: [false, false, false, false, false, false, false, true], // Only Gary owned
            rewards: [false, false, false, false, false], // 5 playtime rewards
            soundEnabled: true,
            lastSave: Date.now(),
            startTime: Date.now(),
            totalPlaytime: 0
        };

        // Game data with Larry Lobster added
        const characters = [
            { name: "SpongeBob SquarePants", image: "https://static.wikia.nocookie.net/cartoons/images/e/ed/Profile_-_SpongeBob_SquarePants.png/revision/latest?cb=20240420115914", cps: 50, cost: 10000 },
            { name: "Patrick Star", image: "https://static.wikia.nocookie.net/spongebob/images/5/5d/Patrick_stock_art.png/revision/latest?cb=20210812083708", cps: 25, cost: 5000 },
            { name: "Squidward Tentacles", image: "https://static.wikia.nocookie.net/spongebob/images/1/15/Squidward_Tentacles.svg/revision/latest?cb=20200416093600", cps: 15, cost: 2500 },
            { name: "Mr. Eugene Krabs", image: "https://static.wikia.nocookie.net/spongebob/images/f/f8/Mr._Krabs_stock_art.png/revision/latest?cb=20210806140149", cps: 10, cost: 1000 },
            { name: "Larry the Lobster", image: "https://static.wikia.nocookie.net/spongebob/images/0/05/Larry_the_Lobster_stock_image_standing.png/revision/latest/scale-to-width-down/1000?cb=20250218034609", cps: 5, cost: 350 },
            { name: "Sandy Cheeks", image: "https://static.wikia.nocookie.net/spongebob/images/a/a0/Sandy_Cheeks_stock_art.png/revision/latest?cb=20190529000455", cps: 7, cost: 500 },
            { name: "Sheldon J. Plankton", image: "https://static.wikia.nocookie.net/villains/images/6/6b/EvilPlankton24.png/revision/latest?cb=20220817102102", cps: 3, cost: 100 },
            { name: "Gary the Snail", image: "https://static.wikia.nocookie.net/spongebob/images/9/9e/Gary_looking_up_stock_art.png/revision/latest?cb=20181227162221", cps: 1, cost: 0 }
        ];

        const upgrades = [
            { id: 'spatula', name: 'Golden Spatula', desc: 'Doubles click power', baseCost: 50, costMultiplier: 2, effect: 'click', multiplier: 2 },
            { id: 'grill', name: 'Super Grill', desc: '+5 CPS per level', baseCost: 200, costMultiplier: 1.5, effect: 'cps', bonus: 5 },
            { id: 'fryer', name: 'Turbo Fryer', desc: '+15 CPS per level', baseCost: 1000, costMultiplier: 1.8, effect: 'cps', bonus: 15 },
            { id: 'register', name: 'Cash Register Pro', desc: '+50 CPS per level', baseCost: 5000, costMultiplier: 2.2, effect: 'cps', bonus: 50 },
            { id: 'restaurant', name: 'Krusty Krab Expansion', desc: '+200 CPS per level', baseCost: 25000, costMultiplier: 3, effect: 'cps', bonus: 200 }
        ];

        const playtimeRewards = [
            { name: '1 Minute Helper', desc: '+50 Clams', time: 1 * 60 * 1000, reward: 50 },
            { name: '3 Minute Worker', desc: '+150 Clams', time: 3 * 60 * 1000, reward: 150 },
            { name: '5 Minute Hero', desc: 'Unlock Larry Lobster!', time: 5 * 60 * 1000, reward: 'larry' },
            { name: '10 Minute Champion', desc: '+2x Click Power', time: 10 * 60 * 1000, reward: 'clickPower' },
            { name: '30 Minute Legend', desc: '+5000 Clams', time: 30 * 60 * 1000, reward: 5000 }
        ];

        // Audio system
        const audioContext = typeof AudioContext !== 'undefined' ? new AudioContext() : null;

        function playClickSound() {
            if (!gameState.soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
            
            gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
        }

        function playUnlockSound() {
            if (!gameState.soundEnabled || !audioContext) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.2);
            oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.4);
            
            gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.4);
        }

        // Save/Load system
        function saveGame() {
            try {
                gameState.lastSave = Date.now();
                gameState.totalPlaytime = getTotalPlaytime();
                showNotification('Game saved!');
            } catch (e) {
                console.error('Failed to save game:', e);
            }
        }

        function loadGame() {
            try {
                return false; // No localStorage available
            } catch (e) {
                console.error('Failed to load game:', e);
            }
            return false;
        }

        function resetGame() {
            if (confirm('Are you sure you want to reset your progress? This cannot be undone!')) {
                location.reload();
            }
        }

        // Playtime system
        function getTotalPlaytime() {
            return gameState.totalPlaytime + (Date.now() - gameState.startTime);
        }

        function formatPlaytime(milliseconds) {
            const minutes = Math.floor(milliseconds / (1000 * 60));
            const hours = Math.floor(minutes / 60);
            
            if (hours > 0) {
                return `${hours}h ${minutes % 60}m`;
            }
            return `${minutes}m`;
        }

        function checkPlaytimeRewards() {
            const currentPlaytime = getTotalPlaytime();
            
            playtimeRewards.forEach((reward, index) => {
                if (!gameState.rewards[index] && currentPlaytime >= reward.time) {
                    gameState.rewards[index] = true;
                    claimPlaytimeReward(reward, index);
                }
            });
        }

        function claimPlaytimeReward(reward, index) {
            if (typeof reward.reward === 'number') {
                gameState.clams += reward.reward;
                showNotification(`${reward.name}: +${reward.reward} clams!`);
            } else if (reward.reward === 'clickPower') {
                gameState.clickPower *= 2;
                showNotification(`${reward.name}: Click power doubled!`);
            } else if (reward.reward === 'cps') {
                gameState.cps += reward.bonus;
                showNotification(`${reward.name}: +${reward.bonus} CPS!`);
            } else if (reward.reward === 'larry') {
                // Unlock Larry Lobster (index 4 in characters array)
                if (!gameState.characters[4]) {
                    gameState.characters[4] = true;
                    showNotification(`${reward.name}: Larry Lobster unlocked!`);
                    showUnlockPopup('Larry the Lobster');
                } else {
                    // If already unlocked, give bonus clams instead
                    gameState.clams += 500;
                    showNotification(`${reward.name}: +500 bonus clams!`);
                }
            }
            
            playUnlockSound();
            saveGame();
        }

        // Notification system
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: rgba(25, 25, 112, 0.9);
                backdrop-filter: blur(20px);
                color: white;
                padding: 12px 20px;
                border-radius: 10px;
                border: 1px solid rgba(100, 149, 237, 0.4);
                box-shadow: 0 8px 32px rgba(25, 25, 112, 0.5);
                z-index: 10001;
                font-weight: 500;
                transform: translateX(100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.transform = 'translateX(0)', 100);
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Utility functions
        function getCurrentCharacter() {
            return characters[gameState.currentCharacterIndex];
        }

        function recalculateStats() {
            gameState.clickPower = calculateClickPower();
            gameState.cps = characters[gameState.currentCharacterIndex].cps + calculateBonusCPS();
        }

        function calculateBonusCPS() {
            let bonus = 0;
            bonus += gameState.upgrades.grill * upgrades.find(u => u.id === 'grill').bonus;
            bonus += gameState.upgrades.fryer * upgrades.find(u => u.id === 'fryer').bonus;
            bonus += gameState.upgrades.register * upgrades.find(u => u.id === 'register').bonus;
            bonus += gameState.upgrades.restaurant * upgrades.find(u => u.id === 'restaurant').bonus;
            return bonus;
        }

        function calculateClickPower() {
            let power = 1;
            const spatulaUpgrade = upgrades.find(u => u.id === 'spatula');
            power *= Math.pow(spatulaUpgrade.multiplier, gameState.upgrades.spatula);
            return power;
        }

        function getUpgradeCost(upgrade) {
            return Math.floor(upgrade.baseCost * Math.pow(upgrade.costMultiplier, gameState.upgrades[upgrade.id]));
        }

        // Game actions
        function clickCharacter() {
            const clickValue = gameState.clickPower;
            gameState.clams += clickValue;
            
            playClickSound();
            createFloatingClam(clickValue);
            checkCharacterUnlocks();
        }

        function createFloatingClam(value) {
            const container = document.querySelector('.character-container');
            const floatingClam = document.createElement('div');
            floatingClam.className = 'floating-clam';
            floatingClam.textContent = '+' + value.toLocaleString();
            
            // Random position around the character
            const angle = Math.random() * Math.PI * 2;
            const radius = Math.min(120, container.offsetWidth * 0.4);
            const centerX = container.offsetWidth / 2;
            const centerY = container.offsetHeight / 2;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            
            floatingClam.style.left = x + 'px';
            floatingClam.style.top = y + 'px';
            
            container.appendChild(floatingClam);
            
            setTimeout(() => {
                if (container.contains(floatingClam)) {
                    container.removeChild(floatingClam);
                }
            }, 1200);
        }

        function checkCharacterUnlocks() {
            for (let i = 6; i >= 0; i--) { // Start from Plankton and go up
                if (!gameState.characters[i] && gameState.clams >= characters[i].cost) {
                    unlockCharacter(i);
                    break;
                }
            }
        }

        function unlockCharacter(index) {
            gameState.characters[index] = true;
            gameState.currentCharacterIndex = index;
            gameState.cps = characters[index].cps + calculateBonusCPS();
            
            playUnlockSound();
            showUnlockPopup(characters[index].name);
            saveGame();
        }

        function showUnlockPopup(characterName) {
            const popup = document.getElementById('unlock-popup');
            const text = document.getElementById('unlock-text');
            text.textContent = `You unlocked ${characterName}!`;
            popup.classList.add('show');
            
            setTimeout(() => {
                popup.classList.remove('show');
            }, 3000);
        }

        function buyUpgrade(upgradeId) {
            const upgrade = upgrades.find(u => u.id === upgradeId);
            const cost = getUpgradeCost(upgrade);
            
            if (gameState.clams >= cost) {
                gameState.clams -= cost;
                gameState.upgrades[upgradeId]++;
                
                if (upgrade.effect === 'click') {
                    gameState.clickPower = calculateClickPower();
                } else if (upgrade.effect === 'cps') {
                    gameState.cps = characters[gameState.currentCharacterIndex].cps + calculateBonusCPS();
                }
                
                playClickSound();
                showNotification(`Bought ${upgrade.name}! Level ${gameState.upgrades[upgradeId]}`);
                saveGame();
                updateDisplay();
            }
        }

        function switchCharacter(index) {
            if (gameState.characters[index] && index !== gameState.currentCharacterIndex) {
                gameState.currentCharacterIndex = index;
                gameState.cps = characters[index].cps + calculateBonusCPS();
                playClickSound();
            }
        }

        // UI Updates
        function updateDisplay() {
            // Update stats
            document.getElementById('clam-count').textContent = Math.floor(gameState.clams).toLocaleString();
            document.getElementById('cps-display').textContent = gameState.cps.toFixed(1) + ' Clams per second';
            document.getElementById('playtime-display').textContent = 'Playtime: ' + formatPlaytime(getTotalPlaytime());
            
            // Update current character
            const currentChar = getCurrentCharacter();
            document.getElementById('current-character-name').textContent = currentChar.name;
            document.getElementById('character-image').src = currentChar.image;
            
            // Update progress
            updateProgress();
            
            // Update lists
            renderRewards();
            renderUpgrades();
            renderCharacters();
        }

        function updateProgress() {
            let nextCharacterIndex = -1;
            for (let i = 6; i >= 0; i--) {
                if (!gameState.characters[i]) {
                    nextCharacterIndex = i;
                    break;
                }
            }
            
            const progressFill = document.getElementById('progress-fill');
            const unlockInfo = document.getElementById('unlock-info');
            
            if (nextCharacterIndex === -1) {
                progressFill.style.width = '100%';
                unlockInfo.textContent = 'You have all characters!';
                return;
            }
            
            const nextCharacter = characters[nextCharacterIndex];
            const progress = Math.min(100, (gameState.clams / nextCharacter.cost) * 100);
            
            progressFill.style.width = progress + '%';
            unlockInfo.textContent = `Collect ${nextCharacter.cost.toLocaleString()} clams to unlock ${nextCharacter.name}!`;
        }

        function renderRewards() {
            const container = document.getElementById('rewards-list');
            container.innerHTML = '';
            
            const currentPlaytime = getTotalPlaytime();
            
            playtimeRewards.forEach((reward, index) => {
                const claimed = gameState.rewards[index];
                const canClaim = currentPlaytime >= reward.time && !claimed;
                const progress = Math.min(100, (currentPlaytime / reward.time) * 100);
                
                const div = document.createElement('div');
                div.className = 'reward-item' + (claimed ? ' claimed' : '') + (canClaim ? ' ready' : '');
                
                const timeStr = formatPlaytime(reward.time);
                const remainingTime = Math.max(0, reward.time - currentPlaytime);
                const remainingStr = remainingTime > 0 ? ` (${formatPlaytime(remainingTime)} left)` : '';
                const statusText = claimed ? ' ✅' : canClaim ? ' READY!' : remainingStr;
                
                div.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${reward.name}${statusText}</div>
                        <div class="item-desc">${reward.desc}</div>
                        <div class="progress-bar" style="margin-top: 5px;">
                            <div class="progress-fill" style="width: ${progress}%;"></div>
                        </div>
                    </div>
                    <div class="item-time">${timeStr}</div>
                `;
                
                container.appendChild(div);
            });
        }

        function renderUpgrades() {
            const container = document.getElementById('upgrades-list');
            container.innerHTML = '';
            
            upgrades.forEach(upgrade => {
                const cost = getUpgradeCost(upgrade);
                const canAfford = gameState.clams >= cost;
                const level = gameState.upgrades[upgrade.id];
                
                const div = document.createElement('div');
                div.className = 'upgrade-item' + (canAfford ? '' : ' disabled');
                div.onclick = () => canAfford && buyUpgrade(upgrade.id);
                
                div.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${upgrade.name} (${level})</div>
                        <div class="item-desc">${upgrade.desc}</div>
                    </div>
                    <div class="item-cost">${cost.toLocaleString()}</div>
                `;
                
                container.appendChild(div);
            });
        }

        function renderCharacters() {
            const container = document.getElementById('characters-list');
            container.innerHTML = '';
            
            characters.forEach((character, index) => {
                const owned = gameState.characters[index];
                const current = index === gameState.currentCharacterIndex;
                
                const div = document.createElement('div');
                div.className = 'character-item' + (owned ? ' owned' : '') + (current ? ' current' : '');
                div.onclick = () => owned && switchCharacter(index);
                
                const statusText = current ? ' (Current)' : owned ? ' (Owned)' : ` (${character.cost.toLocaleString()})`;
                
                div.innerHTML = `
                    <div class="item-info">
                        <div class="item-name">${character.name}${statusText}</div>
                        <div class="item-desc">${character.cps} CPS</div>
                    </div>
                `;
                
                container.appendChild(div);
            });
        }

        // Event listeners
        function initializeEventListeners() {
            // Character clicking with touch support
            const character = document.getElementById('main-character');
            
            character.addEventListener('click', clickCharacter);
            character.addEventListener('touchstart', (e) => {
                e.preventDefault();
                clickCharacter();
            }, { passive: false });

            // Larry Lobster ad
            document.getElementById('larry-ad').addEventListener('click', () => {
                showNotification('Larry the Lobster is available for unlock!');
                playClickSound();
            });

            // Control buttons
            document.getElementById('sound-toggle').addEventListener('click', () => {
                gameState.soundEnabled = !gameState.soundEnabled;
                const btn = document.getElementById('sound-toggle');
                btn.textContent = gameState.soundEnabled ? 'Sound' : 'Muted';
                btn.classList.toggle('muted', !gameState.soundEnabled);
                saveGame();
            });

            document.getElementById('save-btn').addEventListener('click', saveGame);
            document.getElementById('reset-btn').addEventListener('click', resetGame);

            // Close unlock popup on click
            document.getElementById('unlock-popup').addEventListener('click', () => {
                document.getElementById('unlock-popup').classList.remove('show');
            });
        }

        // Game loop using requestAnimationFrame
        let lastTime = 0;
        let accumulatedTime = 0;
        const UPDATE_INTERVAL = 100; // Update every 100ms

        function gameLoop(currentTime) {
            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;
            accumulatedTime += deltaTime;

            // Update clams based on CPS
            if (accumulatedTime >= UPDATE_INTERVAL) {
                gameState.clams += (gameState.cps * accumulatedTime) / 1000;
                accumulatedTime = 0;
                
                // Check for unlocks, rewards, and update display
                checkCharacterUnlocks();
                checkPlaytimeRewards();
                updateDisplay();
            }

            requestAnimationFrame(gameLoop);
        }

        // Auto-save every 30 seconds
        setInterval(saveGame, 30000);

        // Initialize game
        function initGame() {
            // Load saved game or start fresh
            const gameLoaded = loadGame();
            if (!gameLoaded) {
                recalculateStats();
            }

            // Initialize UI
            initializeEventListeners();
            updateDisplay();

            // Start game loop
            requestAnimationFrame(gameLoop);

            // Resume audio context on first interaction
            document.addEventListener('click', () => {
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }, { once: true });

            console.log('SpongeBob Clicker Adventure loaded!');
        }

        // Start the game when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }
    </script>
</body>
</html>
